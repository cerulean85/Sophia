## 자율출퇴근제란?
자율출퇴근제(이하 '자출제')라 함은 말그대로 자율적으로 출근하고 퇴근하는 제도이다.
물론 1주 40시간이라는 법정근로시간은 채워야 한다는 최소한의 제약은 있다.
그런데 자출제 시스템이 구비된 회사가 아니라면, 휴게시간에 대한 규칙을 반드시 알아야 한다.

## 휴게시간? 그게 뭔가요?
근로를 하는 근로자에게는 휴게시간을 부여해야 한다는 근로법이 있다.
근로법상 사용자는 근로자의 근로시간이 4시간일 때마다 30분의 휴게시간을 부여해야 한다.
예를 들어, 근로시간이 4시간이면 30분, 8시간이면 1시간, 12시간이면 1시간 30분을 부여해야 한다.

## 자출제의 꼼수?
다른 근로제도는 하루 기본 근무 8시간이므로, 근로시간과 휴게시간을 합쳐 9시간을 회사에서 체류해야 한다.
자출제의 경우 4시간을 근무했다면, 반드시 4시간 30분을 회사에서 체류해야 한다.
주 40시간의 근로시간을 채워야 하는 자출제에서는 이 휴게시간의 특성을 활용해 꼼수를 부릴 수 있다.
가령, 다음과 같이 체류시간을 줄일 수 있다.

- 월요일 - 근로시간: 7시간 59분 59초 → 체류시간: 8시간 29분 59초 후 퇴근
- 화요일 - 근로시간: 8시간 00분 01초 → 체류시간: 9시간 00분 01초 후 퇴근
- 수요일 - 근로시간: 8시간 00분 00초 → 체류시간: 9시간 00분 00초 후 퇴근
- 목요일 - 근로시간: 8시간 00분 00초 → 체류시간: 9시간 00분 00초 후 퇴근
- 금요일 - 근로시간: 8시간 00분 00초 → 체류시간: 9시간 00분 00초 후 퇴근
- 1주 총 근로시간: 40시간, 체류시간: 44시간 30분

자출제가 아니라면 근로시간과 체류시간은 다음과 같다.
- 월요일 - 근로시간: 8시간 00분 00초 → 체류시간: 9시간 00분 00초 후 퇴근
- 화요일 - 근로시간: 8시간 00분 00초 → 체류시간: 9시간 00분 00초 후 퇴근
- 수요일 - 근로시간: 8시간 00분 00초 → 체류시간: 9시간 00분 00초 후 퇴근
- 목요일 - 근로시간: 8시간 00분 00초 → 체류시간: 9시간 00분 00초 후 퇴근
- 금요일 - 근로시간: 8시간 00분 00초 → 체류시간: 9시간 00분 00초 후 퇴근
- 1주 총 근로시간: 40시간, 체류시간: 45시간

위 예시에서는 무려 회사에서 보내는 시간이 30분(!!)이나 줄어든다.
어떻게 시간을 잘 계산하면 1주 동안 2시간까지 체류시간을 줄일 수 있을 것이고,
4주 동안에는 회사에서 보내는 무려 8시간을 줄일 수 있다. 으어어어~

이렇게까지 극단적으로 시간을 계산하는 사람이 있겠냐마는.. 아무튼 이론적으로는 이렇다ㅋㅋ..

## 알아도 헷갈리는 퇴근 시간 계산
물론 이런 꼼수를 적극적으로(?) 사용하라고 이 글을 쓴건 아니다. (정말?)
이 포지티브(positive)한 휴게시간 규정 때문에 난감했던 적이 있었기 때문에 내용을 꼭 공유하고 싶었다.
알고 나면 참 간단하지만, 필자는 이걸 잘 몰라서 억울하게 아까운 휴가를 반납할 뻔 하기도 했다.
다행히 그 때는 우리 회사의 착한 직원 분들이 잘 처리해주셔서 가슴을 쓸어내렸지만,
이런 규정을 잘 알고 난 후에도 퇴근시간을 계산하는 일은 늘 모호하고 헷갈린다.

## 자출제 퇴근 시간 계산 프로그램
모르면 어렵지만 알고나면 생각보다 간단한 규정이라 엑셀로도 어렵지 않게 프로그램을 만들 수 있다.
자출제를 시행하는 회사라면 이미 대부분의 회사가 아마 계산 프로그램이 전사적으로 존재할 것이다.

그럼에도 불구하고 전사적으로 사용되어야 하고 바뀐 근로 규정을 적용해야 한다는 요구사항을 고려한다면,
이런 계산 프로그램 조차 괘나 수준있는 난이도의 프로그램이 되고 만다. (그러니까 ERP라는 분야가 따로 있는 거겠지!?)

이미 누군가는 열심히 프로그래밍을 하고 있겠지만,
이정도 난이도면 토이프로젝트로 심심풀이 땅콩으로 해보면 재미있을 것 같아 직접 만들기로 했다.


## 사용자 시나리오
1. 퇴근 시간 계산
    - 회원 가입
    - 사용자 로그인
    - 비밀번호 찾기
    - 한 주 동안의 출퇴근 시간을 타이핑(typing) or Copy&Paste
    - 퇴근 시간 계산

2. 히스토리 조회
    - 메뉴 선택
    - 연도별 히스토리 조회
    - 페이지 네비게이션으로 이동


## 기능 리스트
1. 사용자
    - 회원 가입
    - 비밀번호 수정 및 찾기
    - 로그인
    - 회원 정보 수정
    - 금주 퇴근 시간 계산
        - 계산 테이블
            - 행 데이터: 날짜, 요일, 출장(체크), 휴일(체크), 아침식사(체크), 출근시간, 퇴근시간, 체류시간, 비업무시간, 비고
        - 합계 테이블
            - 퇴근 가능 시간, 총 근로시간, 총 휴게시간, 총 체류시간, 총 비업무시간
        - 기준 시간 테이블(팝업)
            - 기준 근무시간: 4시간
            - 기준 휴게시간: 30분
            - 아침식사 차감시간: 30분
            - 기준 출장 근무시간: 9시간
            - 시간 산출 근거(텍스트)
    - 히스토리 조회
        - 필터링: 연도별(기본-금년도)
        - 정렬: 주차별 오름차순/내림차순 정렬
        - 페이지 네비게이션

2. 관리자
    - 회원 조회: 리스트
        - 회원 차단: 리스트 아이템 우측 버튼
        - 회원 정보 수정: 리스트 아이템 우측 버튼, 팝업
        - 페이지 네비게이션
    - 히스토리 조회
        - 필터링1: 회원별(선택필수, 팝업)
        - 필터링2: 연도별(기본-금년도)
        - 정렬: 주차별 오름차순/내림차순
        - 페이지 네비게이션

## 기준 시간
- 1주 법정근로시간: 40시간
- 기준 근무시간: 4시간
- 기준 휴게시간: 30분
- 아침식사 차감시간: 30분
- 기준 출장 근무시간: 9시간
- 기준 휴가 근무시간: 8시간

## 계산 시간
- 누적시간: 출장근로, 휴일
- 차감시간: 아침식사, 비업무
- 고정시간(체크): 출장근로, 휴일, 아침식사
- 유동시간(타이핑): 출근시간, 퇴근시간, 비업무시간
- 자동계산: 일일 체류시간, 일일 근로시간, 마지막 정산출근일에 대한 필요 체류시간, 필요 근무시간

## 합계 시간
- 퇴근 가능 시간, 총 근로시간, 총 휴게시간, 총 체류시간, 총 비업무시간
- 데이터베이스에 합계 시간은 저장하지 않고 애플리케이션에서 집계

## 합계 시간 계산 규칙
1. 계산 테이블 모든 행이 입력된 경우에만 합계 시간 집계
2. 일일 근로시간 계산: 아침식사 및 비업무시간을 차감
3. 필요시간 계산: 일일 근로시간에 비례한 기준 휴게시간 적용
    - 필요근무시간 = 1주법정근로시간 - 일일근로시간합계
    - 휴게단위(소수점 버림) = 필요근무시간 / 기준근무시간 
    - 필요체류시간 = 필요근무시간 + (기준휴게시간 * 휴게단위)
4. 한 주 중 마지막 정상 출근에 대한 필요시간 계산
    - 예시1: 월화수목금-정상출근 → 금요일에 대한 합계 시간 조정
    - 예시2: 월화수-정상출근, 목금-출장 → 수요일에 대한 합계 시간 조정
    - 예시3: 월금-출장, 화-휴가, 화수목-정상출근 → 목요일에 대한 합계 시간 조정
    

## API 목록
- 사용자 로그인
- 사용자 회원가입
- 사용자 비밀번호 찾기
- 사용자 회원정보 수정
- 사용자 히스토리 조회(연도별)
- 사용자 기준 시간, 금주 계산 시간 호출
- 관리자 로그인
- 관리자 회원조회
- 관리자 회원차단
- 관리자 회원정보 수정(권한부여 포함)
    - 권한: admin, user
- 관리자 히스토리 조회(회원별, 연도별)


## 데이터베이스 스키마
- organization: 조직 테이블 (내부용, 사용자 인터페이스 미지원)
    - no: 조직 번호
    - name: 조직명

- department: 부서 테이블 (내부용, 사용자 인터페이스 미지원)
    - no: 부서번호
    - org_no: 조직 번호
    - name: 부서명

- authority: 권한 테이블 (내부용, 사용자 인터페이스 미지원)
    - no: 권한 번호
    - type: 권한 유형(admin/user)

- user: 사용자 테이블(암호화)
    - no: 회원번호
    - id: 회원아이디
    - password: 비밀번호
    - name: 이름
    - secret_no: 사번 등 비공개 번호
    - auth_no: 권한번호
    - block: 차단 여부

- user_time_table: 사용자 시간 테이블
    - idx: 사용자 시간 식별번호
    - user_no: 사용자 번호
    - std_week_no: 주차 식별번호
    - chk_biz_trip: 출장여부
    - chk_vacation: 휴가여부
    - chk_breakfast: 아침식사 여부
    - commute_time: 출근시간
    - return_time: 퇴근시간
    - non_biz_hour: 비업무 시간
    - description: 비고, 설명

- std_time: 기준 시간 테이블 (내부용, 사용자 인터페이스 미지원)
    - statutory_working_hour_per_week: 1주법정근로시간-2400분(40시간)
    - std_working_hour: 기준근무시간-240분(4시간)
    - std_break_time: 기준휴게시간-30분
    - breakfast_deduction_time: 아침식사차감시간-30분
    - std_biz_trip_working_hour: 기준출장근무시간-540분(9시간)
    - std_vacation_working hour: 기준휴가근무시간-480분(8시간)

- std_week: 주차 테이블. 10년치 주차 정보 입력 (내부용, 사용자 인터페이스 미지원)
    - idx: 주차 식별번호
    - year: 연도
    - week_no: 주차번호
    - start_date: 주차 시작일
    - end_date: 주차 종료일



## 퇴근 시간 계산 화면 설계
- 웹 페이지는 



## 시스템 구성도
- 클라우드 기반으로 시스템을 구성
- 클라우드를 사용하지 않아도 되지만, 토이프로젝트란 엄연히 개인의 욕심(?)과 사심(?)을 채우기 위해 하는 것(ㅋㅋ)
- 마침 AWS-SAP 공부 중이고, AWS 실습이 필요한 찰나였으므로 아키텍처는 거대하게 가져 갈거다!!


## 사용자 인터페이스 구현


## 단위 테스트