# Amazon S3

- 업계 최고의 확장성, 데이터 가용성, 보안 및 성능을 제공하는 객체 스토리지 서비스
- 모든 규모와 업종의 고객은 Amazon S3를 사용하여 데이터 레이크, 웹 사이트, 모바일 애플리케이션, 백업 및 복원, 아카이브, 엔터프라이즈 애플리케이션, IoT 디바이스, 빅데이터 분석 등 다양한 사용 사례에서 원하는 양의 데이터를 저장하고 보호할 수 있음
- Amazon S3는 특정 비즈니스, 조직 및 규정 준수 요구 사항에 맞게 데이터에 대한 액세스를 최적화, 구조화 및 구성할 수 있는 관리 기능을 제공

[Amazon S3란 무엇인가요? - Amazon Simple Storage Service](https://docs.aws.amazon.com/ko_kr/AmazonS3/latest/userguide/Welcome.html)

- Simple Storage Service(S3)
- AWS의 메인 스토리지
- 매우 안전하고 가변적인 오브젝트 저장 공간을 제공
- 스토리지 공간에 구애받지 않고 마음껏 사용 가능
- AWS 자체에서 보안을 신경 쓰므로 사용자는 마음 편히 오브젝트를 업로드/다운로드할 수 있음
- 오브젝트 저장 공간을 제공하기 때문에 사진, 동영상, 스프레드시트 등 다양한 파일을 업로드할 수 있음
- 비정형화 데이터를 다룰 수 있음
- 오브젝트의 최대 크기는 5TB (내 컴퓨터의 하드는 파일 크기가 최대 250GB)
- 사실상 스토리지 공간이 무한하며, 버킷 생성 시에도 크기 걱정할 필요가 없음
- 버킷 생성 시 이름은 지역과 무관하고 고유해야 함
- IAM과 마찬가지로 글로벌 서비스

### 오브젝트

- 오브젝트는 키-값(Key-Value) 조합으로 구성
- 키는 ‘오브젝트 파일명’, 값은 ‘오브젝트 내용물’에 해당
- 버킷에 업로드된 파일을 버전 1이라 할 때, 똑같은 파일을 업로드하면 다른 내용이 들어있다면 버전 2로 업로드할 수 있음
- 버전을 이용하면 이전 오브젝트로 복원 가능
- 메타데이터는 ‘데이터의 데이터’란 뜻으로 데이터의 정보를 담고 있음
- 데이터가 생성된 시간, 변경된 시간, 데이터 업데이트 권한을 가진 팀원 정보 등을 모두 메타데이터에서 확인 가능
- 오브젝트에 변화가 생기면 메타데이터도 그에 맞게 자동으로 변경됨
- 교차 출처 리소스 공유(cross origin resource sharing, CORS)는 다른 버킷의 오브젝트 접근 권한을 허용한다는 뜻으로, **버킷 A오브젝트에 접근 시 버킷 B에서 접근**할 수 있도록 함

  > 📌 교차 출처 리소스 공유(cross origin resource sharing, CORS)는 다른 도메인에 속한 다른 클라이언트 웹 애플리케이션끼리 데이터를 공유하고 주고받을 수 있게 다리를 놓아주는 역할을 하며, S3에 존재하는 JSON 포맷의 역할이며 웹 사이트 호스팅과 매우 밀접한 관련이 있음


### 데이터 일관성 모델(Data Consistency Model)

- 쓰기 일관성 후 읽기 모델(read after write consitency model)
    - 오브젝트가 버킷에 업로드된 후 지연 없이 바로 사용가능하다는 뜻
    - 강한 일관성 모델(strong consistency model)이라고도 함
- 최종 일관성 모델(eventual consistency model)
    - UPDATE, DELETE 명령어를 수행하여 오브젝트가 수정 혹은 삭제가 되었을 때 결과가 바로 반영 되지 않을 때가 있음
    - S3 버킷에 들어있는 오브젝트는 한 지역에 여러 개의 노드가 연결되어 있으며 오브젝트에 변화가 생기면 모든 노드에 적용이 됨
    - 그러나 이 변화는 한 번에 모든 노드에서 일어나지 않고 약간의 지연이 발생하므로 유저가 오브젝트에 접근 시 아직 적용되지 않은 노드에서 데이터를 읽을 때 UDPATE 이전 결과를 얻을 수 있음
    - 이러한 지연은 체감하기는 어려우며, 이론적으로나 강한 일관성 모델에 비해 지연이 발생한다는 의미임

### 스토리지 유형

- 일반 S3 버킷
    - 가장 보편적인 버킷으로, 처음 버킷 만들 때 디폴트로 선택됨
    - 높은 내구성(durability)과 가용성(availability)를 자랑함
        - 내구성: 오브젝트가 손실 없이 얼마나 잘 유지되는지, 
        - 가용성: 오브젝트에 얼마나 쉽게 접근할 수 있는지에 해당하는 내용
    - 일반 S3 버킷은 데이터 손실은 거의 100% 가까이 막아줌
    - 클라우드, 모바일 게임 애플리케이션, 빅데이터 분석에서 주로 사용됨
- S3 IA bucket(Infrequent access bucket)
    - 오브젝트에 ```자주 접근하지 않으나``` 오브젝트가 많아 ```신속한 접근이 요구될 때``` 뛰어난 성능을 발휘함
    - 클라우드 재해 복구(disaster recovery), ```백업 파일 보관```에 사용
    - 일반 S3 버킷에 비해 ```유지 비용은 저렴```하나 ```오브젝트에 접근 시 추가 비용이 발생```함
    - 신속한 접근이 가능한 이유는 다중 가용 영역을 사용하기 때문
    - 내구성과 가용성이 매우 우수함
- S3 Single Zone Bucket
    - 하나의 존에만 의존하며, S3 버킷과 S3 IA bucket에 비해 내구성과 가용성이 떨어짐
    - 버킷이 들어있는 가용 영역이 다운되면 버킷에 들어있는 오브젝트에 접근할 수 없을 수 있으며, 데이터 손실이 발생할 수 있음
    - IA 버킷에 비해 20% 정도 저렴하며, IA 버킷과 마찬가지로 버킷의 접근이 잦지 않은 오브젝트를 관리할 때 사용
    - 값싼 비용으로 버킷의 접근이 잦지 않은 경우 가용성과 내구성을 어느 정도 감수할 수 있을 때 사용
- S3 글레시어 버킷(Glacier Bucket)
    - 몇 년에 한 번 오브젝트에 접근 할까 말까 하는 상황이 발생할 때 사용하면 좋은 스토리지 유형
    - 유지 비용이 굉장히 저렴하지만, 오브젝트에 접근할 때 4~5시간 걸림

    - Glacier에서 아카이브는 문서, 비디오, TAR, ZIP 파일 등 저장 객체를 가리키는 말이며, Glacier valults(볼트)에 저장
        - 볼트는 S3에서 버킷에 대응되는 개념이지만, 전역에서 유일무이한 이름을 부여할 필요는 없음

    
    - Glacier 스토리지 클래스
        - Amazon S3 Glacier Instant Retrieval
            - 99.999999999%의 내구성, 99.9%의 가용성, ```밀리초``` 단위의 검색 시간, 분기당 한 번 액세스에 적합

            - 분기당 한 번 액세스되고 밀리초 단위의 검색이 필요한 수명이 긴 데이터에 대해 S3 Standard-Infrequent Access 보다 최대 68% 비용의 가장 저렴한 스토리지 제공

            - 이미지 호스팅, 온라인 파일 공유 애플리케이션, 의료 영상 및 건강 기록, 뉴스 미디어 자산, 위성 및 항공 영상 같이 성능에 민감하고 즉시 액세스할 수 있어야 하는 데이터용으로 설계

            - 저렴한 GB당 스토리지 요금과 조금 더 높은 GB당 검색 요금으로 S3 Standard-IA와 유사하면서 뛰어난 내구성, 높은 처리량 및 짧은 대기 시간을 제공

        - Amazon S3 Glacier Flexible Retrieval
            - 99.999999999%의 내구성, 99.99%의 가용성, ```수 분~몇 시간(최대 12시간)```의 검색 시간, 연간 1~2회 액세스에 적합

            - 연간 1~2회 액세스하고 비동기식으로 검색되는 아카이브 데이터에 대해 S3 Glacier Instant Retrieval 보다 최대 10% 더 저렴한 비용으로 스토리지 제공

            - S3 Glacier Flexible Retrieval(이전 S3 Glacier)은 즉각적인 액세스가 필요하지 않지만 백업 또는 재해 복구 사용 사례와 같이 대규모 데이터 집합을 무료로 검색할 수 있는 유연성이 필요한 아카이브 데이터에 이상적인 스토리지 클래스

            - 몇 분 덩도에서 몇 시간까지 다양한 액세스 시간에서 비용의 균형을 조정하는 가장 유연한 검색 옵션과 무료 대량 검색 기능을 제공
                - 가끔 몇 분 안에 일부 데이터를 검색해야 하고 비용에 대해 걱정하고 싶지 않은 경우나 백업, 재해복구, 오프사이트 데이터 스토리지 요구 사항에 대해 적합한 솔루션
                - 특정 연도에 물리적으로 분리된 여러 AWS AZ에서 데이터를 중복 저장하여  99.999999999%(9 11개)의 데이터 내구성과 99.99%의 가용성을 지원하도록 설

        - Amazon S3 Glacier Deep Archive
            - 99.999999999%의 내구성, 99.99%의 가용성, ```12~48시간```의 검색 시간, 연 1회 미만 액세스에 적합, 가장 저렴한 스토리지
            - 최저 비용 스토리지 제공
            - 연 1회 미만으로 액세스되고 비동기식으로 검색되는 수명이 긴 아카이브 데이터의 경우 S3 Glacier 대비 최대 78%까지 비용을 낮출 수 있음
            - 매월 GB당 0.000099 USD(TB당 약 1USD)로 클라우드에서 가장 저렴한 스토리지를 제공

            - 온프레미스 테이프에서 데이터를 저장 및 유지 관리하거나 오프사이트에서 데이터를 보관하는 것보다 훨씬 낮은 가격으로 이용할 수 있음
            - 비용 효율적이고 관리하기 쉬운 테이프의 대안
            - 데이터 집합을 7~10년 이상 보관하는 금융 서비스, 의료, 미디어, 엔터테인먼트, 공공 부문의 고객을 위해 설계
            -  특정 연도에 물리적으로 분리된 여러 AWS 가용 영역에서 데이터를 중복 저장하여 99.999999999%(9 11개)의 데이터 내구성과 99.99%의 가용성을 지원하도록 설계


- S3 Intelligent tiering 버킷
    - 지능적 티어링 버킷은 사용자의 오브젝트 접근 주기를 분석하고 세 가지 티어 중 하나를 선택함
        - Frequent Tier: 오브젝트 접근이 종종 일어날 때 사용
        - Lower-Cost Tier: 오브젝트 접근이 드문 경우 사용
        - Very Low-Cost Tier: 글레시어처럼 몇 년에 한 번 접근할 때 사용
    - Frequent Tier가 다른 티어에 비해 약간 비쌈

### S3 요금

- 오브젝트를 버킷에 업로드 시 GB당 비용을 지불하며, 일반 버킷을 사용할 경우 첫 50TB 사용에 한해 GB당 0.023달러의 비용이 발생
- 오브젝트 크기가 늘어날 경우 GB당 발생하는 비용은 다소 낮아짐
- PUT, COPY, GET 명령어를 얼마나 사용하느냐에 따라 비용이 달라짐
- 다른 AWS 리소스로 오브젝트를 전송하거나 메타데이터를 사용할 때 비용이 발생함

<aside>
📌 오브젝트에 태그가 걸려 있다면, 태그에는 어떤 부서에서 오브젝트를 관리하는지, 어떤 유형의 오브젝트인지, 언제 생성되었는지에 대한 정보가 들어있는데, 이런 정보가 들어 있는 태그를 사용할 경우 추가 비용이 발생함

</aside>

### 버킷 정책 & 접근 제어 리스트

- 디폴트 값으로 버킷을 만들면 버킷을 만든 사용자만 버킷에 대한 모든 권한을 가짐
- 최초 버킷 생성 시 비공개화됨
- 외부에서 누군가 버킷에 접근할 경우 접근 금지(access denied) 에러가 발생하지만, 특정 유저 혹은 그룹에게 버킷 접근을 허용해야 할 때가 있음
- 이를 위해 버킷 정책(bucket policy), 접근 제어 리스트(access control list) 변경을 할 수 있음
    - 버킷 정책 변경
        - JSON 포맷으로 이루어져 있으며 버킷 안에 있는 모든 오브젝트의 접근 권한 설정을 가능하게 함
    - 접근 제어 리스트 변경
        - 버킷 정책은 하나의 버킷에 모두 적용되는 반면 접근 제어 리스트는 버킷 안의 오브젝트, 디렉터리별로 권한 설정이 가능함

### 암호화 유형

- 파일 업로드/다운로드 시에는 SSL/TLS 적용
- S3 버킷을 사용하지 않는 경우
    - SSE-S3
        - SSE(Server-Side Encryption)는 디폴트로 AWS에 의해 관리되며, 버킷에 저장된 모든 오브젝트는 고유한 키를 지님
        - SSE-S3는 모든 키를 관장하는 마스터키를 갖고 있음
        - 마스터키는 AES-256이라는 암호화 유형이 사용되며, 고급 암호화 표준(Advanced Encryption Standard(AES) 뒤에 256은 256비트 암호화를 사용한다는 의미
        - 마스터키 정보는 일정 시간이 지날 때마다 변경됨
    - SSE-KMS
        - SSE-S3와 마찬가지로 AWS에서 일괄적으로 관리됨
        - 오브젝트를 버킷에 업로드하거나 기존에 존재하는 오브젝트를 복사할 때 SSE-KMS 암호화 방식을 사용할 수 있음
        - 버킷에 있는 오브젝트에 암호화할 수도 있음
        - 누가, 언제, 어떻게 암호화되어 있는 오브젝트에 접근했는지 상세한 정보를 제공하며, 이는 SSE-S3에서는 없는 기능임
        - 데이터 감시 및 디버깅 프로세스 시 유용하게 사용할 수 있음
        
        <aside>
        📌 KMS(Key Management Service)는 AWS 리소스이며 API 토큰 정보, 애플리케이션 암호 등 민감한 데이터를 사용하고 보관함
        
        </aside>
        
    - SSE-C
        - 개발자가 직접 암호를 관리하고, 생성한 암호를 직접 사용할 수 있음
        - 오브젝트에 원하는 암호를 업데이트하면 AWS에서 자동으로 암호화/해독화
        - AES-256 포맷 지원하며, 유일하게 **AWS 콘솔에서 암호화할 수 없음**
        - AWS CLI, AWS SDK, AWS API 통해서만 암호 설정할 수 있음

[업무에 바로 쓰는 AWS 입문 - YES24](https://www.yes24.com/Product/Goods/116626210)

### Amazon S3 기능

1. 스토리지 클래스
2. 스토리지 관리
3. 액세스 관리 및 봉
4. 데이터 처리
5. 스토리지 로깅 및 모니터링
6. 분석 및 인사이트
7. 강력한 일관성

### Amazon S3 작동 방식

1. 버킷
2. 객체
3. 키
4. S3 버전 관리
5. 버전 ID
6. 버킷 정책
7. S3 액세스 포인트
8. ACL(액세스 제어 목록)
9. 리전

### Amazon S3 데이터 일관성 모델

1. 동시 애플리케이션

### 관련 서비스

1. Amazon Elastic Compute Cloud(Amazon EC2)
2. Amazon EMR
3. AWS Snow Family
4. AWS Transfer Family

### Amazon S3 요금 지불


## 전송 가속화(S3 Transfer Acceleration)

- 인터넷을 통해 S3 버킷에 더 빠르게 데이터를 전송할 수 있는 기능

- CloudFront의 전세계적으로 분산된 엣지 로케이션을 활용하여 데이터가 전송되는 위치에 관계없이 전송을 가속화할 수 있음

- 인터넷을 통하지 않고 CloudFront 엣지 로케이션을 통해 데이터를 라우팅하여 작동
- 전송 가속화를 활성화하면 Amazon 네트워크를 통한 전송에 최적화된 버킷의 고유한 URL을 생성하고, 이를 사용하여 버킷에 데이터를 업로드하면 가장 가까운 CloudFront 엣지 로케이션을 통해 데이터가 자동으로 라우팅돼 전송 속도를 개선하고 지연시간 줄일 수 있음

- 장거리에 걸친 대규모 데이터 전송이나 전송 속도에 영향을 줄 수 있는 네트워크 문제 또는 정체가 있는 경우 특히 유용

- 원격 위치와의 데이터 전송 또는 전 세계에서 데이터에 액세스하는 고객의 성능을 개선하는 데 사용할 수 있음

- S3 버킷에 대해 활성화하고 버킷에 액세스하는 데 사용하는 URL을 업데이트 하기만 하면 됨

- AWS Management Console, AWS CLI 또는 AWS SDK를 사용하여 전송 가속화를 활성하하고 전송을 관리할 수 있음

- 소규모 데이터 전송 또는 S3 버킷과 동일한 리전 내에서 발생하는 전송에는 큰 이점을 제공하지 않을 수 잇음

- 표준 S3 전송에 비해 추가 비용이 발생하므로 기능을 신중하게 검토하고 테스트하여 특정 요구 사항과 요구 사항을 충족하는지 확인하는 것이 중요

## 참고사이트
- [AWS S3란?(개념, 속성)](https://somaz.tistory.com/179)