# Amazon CloudWatch
- AWS에는 수많은 리소스가 존재하며, 시간이 지날수록 더 많은 리소스가 생겨날텐데 모든 데이터를 사람이 관리하기는 힘듦

- CloudWatch는 리소스 사용 및 이벤트 등을 실시간으로 모니터링함

- 이벤트란 일련의 사건을 의미하며, 에를 들어, S3 버킷에 파일을 업로드(PUT) 혹은 수정(UPDATE) 할 때 ‘이벤트가 발생했다’고 표현

- 뿐만 아니라 암호화되지 않은 파일을 업로드할 때 접근 거부 에러 메시지가 뜨는 상황 역시 이벤트라 할 수 있음

- CloudWatch는 이벤트를 로그파일로 생성하여 개발자가 실시간으로 무슨 일이 일어났는지 확인할 수 있게 함

- 로그파일은 텍스트 포맷이기 때문에 따로 파싱 과정을 거쳐 사람이 이해하기 쉽게 변형해주는 작업이 필요함  
  - CloudWatch는 한 눈에 보기 쉽게 로그파일을 그래프로 생성하는 매트리스 기능도 제공함

- CloudWatch를 사용하면 이벤트가 발생할 때 개발자가 직접 대시보드를 들어와서 확인하지 않아도 됨
  - 경보 설정을 통해 Amazon SNS 혹은 Lambda로 이벤트의 정보를 전달함
  - 특정 시간에 알림 시간을 세팅하는 것과는 달리 원하는 이벤트가 감지되었을 떄 그에 따라 대처할 수 있음

- 모니터링 종류
  - 기본 모니터링(basic monitoring)
    - 무료, 5분 간격으로 최소환의 데이터를 수집하고 사용자에게 이벤트 발생 여부 알려줌
    - 주로 CPU 사용량, 디스크 사용량, 네트워크 I/O 처리량 관련 상황을 체크할 때 사용
    - AWS 리소스 사용시 ELB와 RDS를 제외하고 디폴트로 기본 모니터링 종류가 사용됨

  - 상세 모니터링(detailed monitoring)
    - 무료는 아니지만 1분 간격으로 매우 자세한 데이터를 수집함
    - 대략 시간당 0.015달러 비용 발생
    - 대부분의 리소스는 기본 모니터링에서 상세 모니터링으로 변경 가능하나, ELB와 RDS는 상세 모니터링 옵션이 디폴트로 선택되어 있으며 이 둘은 기본 모니터링 기능을 사용할 수 없음

- 사용사례
  - 서버 과부하 문제 해결
    - 쇼핑 앱과 같이 비정상적으로 유저가 많이 몰려 서버 과부하 문제가 발생하여 수많은 트래픽으로 인해 병목 현상이 일어나는 경우, CloudWatch를 통해 언제 얼마나 많은 사람이 앱에 접속했는지 로그와 매트리스를 통해 한 눈에 확인할 수 있으며, 이를 기반으로 앱 사용 패턴을 파악하고 병목 현상을 유연하게 대처할 수 있음

  - 비용 절감 효과
    - EC2 인스턴스상의 웹 서버 상태를 점검하며 사용량에 따라 비용을 절감하는 목표를 가지고 있다면, 낮과 밤 시간에 필요한 서버 성능이 다른 경우, 서버 트래픽이 특정 임계점에 도달하였을 때 개발자에게 알려주고 성능을 자동으로 낮출 수 있음

- CloudWatch 경보
  - CloudWatch는 AWS 리소스 자원에 대한 전반적인 데이터를 수집하고 매트리스를 만들어 개발자가 한 눈에 이해할 수 있도록 도와주며, 의사결정에 중요한 정보와 경보 기능을 제공함
  - CloudWatch 경보를 이용하여 이벤트를 발생시켜 개발자의 개입을 최소화하는 자동화 시스템을 구축할 수 있음
  - 경보 상태
    - OK: CloudWatch에서 수집하는 매트리스가 개발자가 지정해놓은 임곗값에서 타당한 값이 들어올 때 뜨는 상태
    - ALARM: 임곗값을 벗어난 상태로, 개발자는 경보가 울렸을 경우 취할 수 있는 행동을 정의할 수 있음
    - INSUFFICIENT_DATA: OK 혹은 ALARM으로 구분 지을 수 있을 만큼 충분한 데이터가 쌓이지 않거나 전달받지 못한 경우에 발생

- 요금 책정
  - AWS를 사용하면서 비용을 지불해 원하는 서비스와 성능을 사용하지만 의도한 바와 달리 터무니없는 금액이 청구되는 경우도 발생
  - 임계점을 설정하여 정해놓은 지출 임곗값을 초과할 경우 Amazon SNS를 통해 경고 메시지를 받을 수 있음
  - 임계점은 AWS 모든 서비스 사용에 대한 총 비용이나 서비스별로 비용을 나눠서 설정할 수 있음
  - 비용이 임계점을 초과할 경우 경보의 상태는 즉시 'ALARM'으로 바뀌며, 지출의 원인을 찾아내는데 CloudWatch가 큰 도움이 됨
  - 서울 지역에서 사용하고 싶다면 지원되는지 확인이 필요함