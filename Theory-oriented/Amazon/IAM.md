# AWS Identity and Access Management
- AWS 리소스에 대한 접근을 안전하게 제어할 수 있는 서비스
- 사용자, 그룹, 역할을 생성하고, 이들에게 특정 AWS 리소스에 대한 접근 권한을 부여할 수 있음
- AWS 계정의 보안을 강화하고, 리소스 접근을 세밀하게 제어할 수 있도록 도와줌

# 주요 기능
- User
  - AWS 리소스에 접근할 수 있는 개별 사용자 계정을 생성할 수 있음
  - 각 사용자에게 고유한 자격 증명(액세스 키, 비밀번호 등)을 부여할 수 있음
- Group
  - 여러 사용자를 그룹으로 묶어, 그룹 단위로 권한을 관리할 수 있음
  - 그룹에 권한을 부여하면, 그룹에 속한 모든 사용자가 해당 권한을 상속받음
- Role
  - 특정 AWS 리소스에 대한 접근 권한을 부여할 수 있는 역할을 생성할 수 있음
  - 사용자, 애플리케이션, 서비스가 임시로 특정 권한을 얻을 수 있도록 함
  - 예를 들어, EC2 인스턴스가 S3 버킷에 접근할 수 있도록 역할을 부여할 수 있음
- Policy
  - JSON 형식의 정책 문서를 사용하여 사용자, 그룹, 역할에 대한 권한을 정의할 수 있음
  - 정책은 허용(Allow) 또는 거부(Deny) 규칙을 포함할 수 있으며, 특정 리소스에 대한 세밀한 접근 제어를 가능하게 함
  - MFA(다단계 인증)
    - 추가적인 보안 계층을 제공하기 위해 다단계 인증을 설정할 수 있음
    - MFA를 사용하면, 사용자가 AWS 리소스에 접근하기 위해 추가적인 인증 단계를 거쳐야 함
  - Federation(연합)
    - 외부 사용자나 시스템이 AWS 리소스에 접근할 수 있도록 연합을 설정할 수 있음
    - SAML 2.0을 사용하여 기업 디렉토리와 통합할 수 있음

# 사용 사례
- 보안 강화
  - IAM을 사용하여 AWS 계정의 보안을 강화하고, 최소 권한 원칙을 적용할 수 있음
  - 각 사용자에게 필요한 최소한의 권한만 부여하여 보안 사고를 줄일 수 있음
- 액세스 제어
  - IAM 정책을 사용하여 특정 리소스에 대한 세밀한 접근 제어를 설정할 수 있음
  - 예를 들어, 특정 S3 버킷에 대한 읽기 권한만 부여하거나, 특정 EC2 인스턴스에 대한 시작/중지 권한만 부여할 수 있음
- 역할 기반 접근 제어
  - 역할을 사용하여 애플리케이션이나 서비스가 특정 리소스에 접근할 수 있도록 설정할 수 있음
  - 예를 들어, Lambda 함수가 DynamoDB 테이블에 접근할 수 있도록 역할을 부여할 수 있음

# AWS Identity and Access Management

- AWS Identify and Access Management
- AWS 리소스에 대한 엑세스를 안전하게 제어할 수 있는 웹 서비스
- IAM 사용 시 사용자가 액세스할 수 있는 AWS리소스를 제어하는 권한을 중앙에서 관리할 수 있음
- IAM을 사용하여 리소스를 사용하도록 인증(로그인) 및 권한 부여(권한 있음)된 대상을 제어함
- AWS 계정 루트 사용자는 루트 사용자만이 수행할 수 있는 작업을 수행하는데 사용
- Billing and Cost Management…
- 이하 IAM 공식 문서 참고하여 추가 작성할 것
- AWS를 사용하는 계정의 권한을 관리하는 서비스
- AWS의 각종 서비스를 사용할 수 있는 사용자를 만들고 해당 사용자에게 ‘어떤 서비스의 어떤 기능을 사용할 수 있는지’와 같은 권한을 설정할 수 있음
- 권한을 사용자가 아닌 서비스에 부여하거나 일시적으로 권한을 부여하는 등 간단한 관리에 그치지 않는 것이 IAM의 특징이며 어려운 부분
- AWS 서비스의 조작 제어는 모두 IAM으로 관리함
- IAM 사용자 및 그룹
    - AWS를 조작하기 위해서 사용하는 것이 IAM 사용자
    - 비밀번호 등의 인증 정보를 사용해 로그인(인증)하면 IAM 사용자에게 할당된 권한을 사용(인가)할 수 있음
- IAM 사용자는 관리 콘솔에서 여러 조작을 할 수 있고 액세스 키라는 인증 정보를 발행해 프로그램이나 CLI에서 계정에 부여된 권한을 사용할 수 있음
- IAM 그룹을 만들어 그룹에 권한을 설정하고 해당 그룹에 IAM 사용자를 추가하면 IAM 사용자는 해당 그룹에 설정된 권한을 사용할 수 있음
- 여러 사용자가 동일한 권한을 갖도록 관리해야 할 때 유용하게 사용할 수 있음

![alt text](../../images/iam1.png)

- IAM 정책
    - ‘어떤 서비스의 기능에 어떤 조작을 할 수 있는지’와 같은 권한은 IAM 정책을 통해 설정 가능
    - 여러 서비스에 권한 설정을 하나로 묶어 이름을 붙여 정의할 수 있어서 동일한 권한을 설정해야 하는 경우 재사용 가능
    - 단일 IAM 사용자, IAM 그룹이나 IAM 역할에 여러 IAM 정책을 연결할 수 있음
    - AWS는 수시로 새로운 서비스나 기능을 추가하기 때문에 사람이 매번 추가되는 기능에 권한을 설정하는 것은 어려움
    - 따라서 AWS에서는 AWS 관리형 정책을 제공함
    - 관리형 정책에는 ‘모든 서비스 사용 가능’, ‘모든 서비스 참조만 가능’, ‘S3의 모든 기능 사용 가능’과 같은 정책이 있으며 서비스나 기능이 추가될 때 자동으로 관련된 권한이 추가되므로 편하게 사용할 수 있음
    - 보다 강력한 권한 설정을 원한다면 사용자가 직접 IAM 정책을 만들어야 함
        - 사용자가 만든 IAM 정책을 고객 관리형 정책이라고 함
        - AWS 서비스와 기능은 매우 많아 고객 관리형 정책의 설정이 어려울 수 있으므로, AWS 콘솔 상의 인터페이스를 통해 원하는 항목을 선택하여 IAM 정책을 생성할 수 있음
- IAM 역할
    - IAM 사용자를 생성할 때 액세스 키도 함께 생성할 수 있음
    - 액세스 키는 CLI로 AWS 자원을 조작하거나 프로그램을 통한 제어를 할 때 사용하는 인증 정보
    - 액세스 키는 고정 문자열이며, AWs 계정과 동일한 권한을 가지므로 유출될 경우 보안 위험에 노출될 수 있음
    - 따라서 AWS 서비스에 권한을 부여할 때는 IAM 역할을 사용하는 것이 좋음
    - IAM 역할을 사용하면 일반적으로 조직의 AWS 리소스에 대한 액세스 권한이 없는 사용자나 서비스에 액세스 권한을 위임할 수 있음
    - IAM 사용자나 AWS 서비스는 AWS API 호출을 수행하는 데 사용할 수 있는 ‘임시 보안 자격 증명’을 획득할 수 있는 권한을 맡을 수 있음
    - 사용자가에 권한을 부여하는 것이 아니라 ‘서비스’에 해당 서비스를 사용할 수 있는 ‘사용자’를 지정하는 것이기 때문에 더 안전하게 서비스를 사용할 수 있음
    - AWS에서는 시스템 구축 시 시스템별로 AWs 계정을 분리할 것을 권장하고 있음
    - 이는 환경의 분리, 관리의 분리, 청구의 분리를 통해 계정을 더 안전하고 효율적으로 관리하기 위함
    - 각 AWs 계정에 사용자 역할별 IAM 역할만 생성하고 IAM 사용자가 필요한 때만 역할을 부여해 적절한 권한으로 작업할 수 있게 설정할 수 있는데, 이를 Role Switch(역할 변경)이라고 하며, 이 기능을 이용해 여러 AWS 계정에 존재하는 IAM 사용자 관리를 간단히 할 수 있음

    ![alt text](../../images/iam2.png)
    ![alt text](../../images/iam3.png)
    ![alt text](../../images/iam4.png)


    

- AWS를 사용하는 계정의 권한을 관리하는 서비스
- AWS의 각종 서비스를 사용할 수 있는 사용자를 만들고 해당 사용자에게 ‘어떤 서비스의 어떤 기능을 사용할 수 있는지’와 같은 권한을 설정할 수 있음
- 권한을 사용자가 아닌 서비스에 부여하거나 일시적으로 권한을 부여하는 등 간단한 관리에 그치지 않는 것이 IAM의 특징이며 어려운 부분
- AWS 서비스의 조작 제어는 모두 IAM으로 관리함
- IAM 사용자 및 그룹
    - AWS를 조작하기 위해서 사용하는 것이 IAM 사용자
    - 비밀번호 등의 인증 정보를 사용해 로그인(인증)하면 IAM 사용자에게 할당된 권한을 사용(인가)할 수 있음


- 계정 관리자가 AWS 리소스로 접근을 통제하는 권한 정책
- 리소스는 고유한 ARN(Amazon Resource Name)을 갖ㅁ
- IAM 권한 정책 중 ```Resource```라는 요소에 ARN을 기술하여 리소스의 접근을 통제
- 리소스는 제공되는 명령어(Operations) 세트로 동작 제어 가능
- ```Action```: 명령어를 사용할 수 있는 사람을 통제하는 IAM 정책
- ```Condition Key```: 어떤 활동의 더 세분화된 통제를 위한 질의키
  - IAM 정책 중 ```Condition``` 요소에 컨디션 키를 참조하여 필요한 추가 환경을 기술할 수 있음
  - ```aws:PrincipalOrgID```
    - 조직의 모든 AWS 계정의 모든 ID를 나열하는 것의 대안을 제공
    - 모든 멤버의 계정을 나열하는 대신 ```Condition``` 요소에 조직 ID를 기술함
    > Principal?
      > 정책에 정의된 권한을 받는 user, service, account
      > ex) The principal is A. A has permission to do B and C.
  - ```aws:PrincipalOrgPaths```
    - 구체적인 조직의 root, OU, children
    - 멤버를 매칭시키기 위한 컨디션 키
    - Principal가 기술된 조직 경로에 있어야 함
  - ```organizations:PolicyType```
    - Organizations 정책 관련 API 명령어를 제한하기 위해 사용
    - 기술된 유형의 Organizations 정책들만 동작시킬 수 있음
    - 컨디션 키값
      - ```AISERVICE_OPT_OUT_POLICY```, ```BACKUP_POLICY```, ```SERVICE_CONTROL_POLICY```, ```TAG_POLICY```